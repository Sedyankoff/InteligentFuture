<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width = device-width, initial-scale=1">
		<link rel="stylesheet" href="style.css">
        <link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css'>
        <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css'>
        <link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/@fullcalendar/core@4.2.0/main.min.css'>
        <link rel='stylesheet' href='https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid@4.3.0/main.min.css'>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css" rel="stylesheet">
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
		<link rel="icon" type="image/x-icon" href="./images/logoint.ico">
		<title>Календар и събития</title>
	</head>

	<body>
		<header>
            <div class="container-fluid d-flex justify-content-center align-items-center text-white bg-dark" id="top-line">
                <div class="row w-100 align-items-center">
                    <div class="col-6">
                        <p class="mb-0">+359 888 888 888</p>
                    </div>
                    <div class="col-6 d-flex justify-content-end">
                      <a href="login.html" class="btn btn-outline-success separator-right" id="login">Влез</a>
                      <a href="register.html" class="btn btn-outline-success" id="register">Регистрирай се</a>
                    </div>
                </div>
            </div>
            <div class = "container-fluid text-gray text-center p-0">
                <div class="bg-image d-flex flex-column justify-content-center align-items-center">
                    <h1 class= "h1 font-weight-bold " id="title">Intelligent Future</h1>
                    <p class= "mt-2" id="slogan">Развиваме мислите. Формираме бъдещето.</p>  
                </div>
            </div>
		</header>
		<nav class="navbar navbar-expand-sm bg-dark">
			<div class="container-fluid justify-content-center">
                <ul class="navbar-nav">
                    <li class="nav-item"><a class="nav-link text-white" href="#">Начало</a></li>
                    <li class="nav-item"><a class="nav-link text-white" href="#">Прием и Записване</a></li>
                    <li class="nav-item"><a class="nav-link text-white" href="#">Ресурсен център и библиотека</a></li>
                    <li class="nav-item"><a class="nav-link text-white" href="#">Календар и събития</a></li>
                    <li class="nav-item"><a class="nav-link text-white" href="#">За Нас</a></li>
                </ul>
            </div>
		</nav>
		<main>
			<div id='calendar'></div>
    <div class="modal fade edit-form" id="form" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header border-bottom-0">
                    <h5 class="modal-title" id="modal-title">Add Event</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <form id="myForm">
                    <div class="modal-body">
                        <div class="alert alert-danger " role="alert" id="danger-alert" style="display: none;">
                            End date should be greater than start date.
                          </div>
                        <div class="form-group">
                            <label for="event-title">Event name <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="event-title" placeholder="Enter event name" required>
                        </div>
                        <div class="form-group">
                            <label for="start-date">Start date <span class="text-danger">*</span></label>
                            <input type="date" class="form-control" id="start-date" placeholder="start-date" required>
                        </div>
                        <div class="form-group">
                            <label for="end-date">End date - <small class="text-muted">Optional</small></label>
                            <input type="date" class="form-control" id="end-date" placeholder="end-date">
                        </div>
                        <div class="form-group">
                            <label for="event-color">Color</label>
                            <input type="color" class="form-control" id="event-color" value="#3788d8">
                          </div>
                    </div>
                    <div class="modal-footer border-top-0 d-flex justify-content-center">
                        <button type="submit" class="btn btn-success" id="submit-button">Submit</button>
                      </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Delete Modal -->
    <div class="modal fade" id="delete-modal" tabindex="-1" role="dialog" aria-labelledby="delete-modal-title" aria-hidden="true">
        <div class="modal-dialog modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="delete-modal-title">Confirm Deletion</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center" id="delete-modal-body">
              Are you sure you want to delete the event?
            </div>
            <div class="modal-footer border-0">
                <button type="button" class="btn btn-secondary rounded-sm" data-dismiss="modal" id="cancel-button">Cancel</button>
              <button type="button" class="btn btn-danger rounded-lg" id="delete-button">Delete</button>
            </div>
          </div>
        </div>
      </div>
		</main>
		<footer class="mt-auto">
            <div class="footer-content text-center bg-dark text-white p-3">
                <p>© 2024 Intelligent Future. Всички права запазени.</p>
                <p>Бул. "Съединение" №46 | +359 888 888 888 | intelligenfuture@gmail.com</p>
                <p>Свържете се с нас: 
                    <a href="https://www.facebook.com" target="_blank"><i class="bi bi-facebook h3 separator-right separator-left"></i></a> 
                    <a href="https://twitter.com" target="_blank"><i class="bi bi-twitter h3 separator-right"></i></a> 
                    <a href="https://instagram.com" target="_blank"><i class="bi bi-instagram h3"></i></a>
                </p>
            </div>
        </footer>
        <script src='https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js'></script>
        <script src='https://cdn.jsdelivr.net/npm/@fullcalendar/core@4.2.0/main.min.js'></script>
        <script src='https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid@4.2.0/main.js'></script>
        <script src='https://cdn.jsdelivr.net/npm/@fullcalendar/interaction@4.2.0/main.js'></script>
        <script src='https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js'></script>
        <script src='https://cdn.jsdelivr.net/npm/uuid@8.3.2/dist/umd/uuidv4.min.js'></script>

        document.addEventListener('DOMContentLoaded', function () {
            const calendarEl = document.getElementById('calendar');
            const myModal = new bootstrap.Modal(document.getElementById('form'));
            const dangerAlert = document.getElementById('danger-alert');
            const close = document.querySelector('.btn-close');
            
          
          
            
          const myEvents = JSON.parse(localStorage.getItem('events')) || [
              {
                id: uuidv4(),
                title: `Edit Me`, 
                start: '2023-04-11',
                backgroundColor: 'red',
                allDay: false, 
                editable: false,
              },
              {
                id: uuidv4(),
                title: `Delete me`,
                start: '2023-04-17',
                end: '2023-04-21',
          
                allDay: false, 
                editable: false,
              },
            ];
          
          
            const calendar = new FullCalendar.Calendar(calendarEl, {
              customButtons: {
                customButton: {
                  text: 'Add Event',
                  click: function () {
                    myModal.show();
                    const modalTitle = document.getElementById('modal-title');
                    const submitButton = document.getElementById('submit-button');
                    modalTitle.innerHTML = 'Add Event'
                    submitButton.innerHTML = 'Add Event'
                    submitButton.classList.remove('btn-primary');
                    submitButton.classList.add('btn-success');
          
                    
          
                    close.addEventListener('click', () => {
                      myModal.hide()
                    })
          
                    
          
                  }
                }
              },
              header: {
                center: 'customButton', // add your custom button here
                right: 'today, prev,next '
              },
              plugins: ['dayGrid', 'interaction'],
              allDay: false,
              editable: true,
              selectable: true,
              unselectAuto: false,
              displayEventTime: false,
              events: myEvents,
              eventRender: function(info) {
                info.el.addEventListener('contextmenu', function(e) {
                  e.preventDefault();
                  let existingMenu = document.querySelector('.context-menu');
                  existingMenu && existingMenu.remove();
                  let menu = document.createElement('div');
                  menu.className = 'context-menu';
                  menu.innerHTML = `<ul>
                  <li><i class="fas fa-edit"></i>Edit</li>
                  <li><i class="fas fa-trash-alt"></i>Delete</li>
                  </ul>`;
          
                  const eventIndex = myEvents.findIndex(event => event.id === info.event.id);
                  
                  
                  document.body.appendChild(menu);
                  menu.style.top = e.pageY + 'px';
                  menu.style.left = e.pageX + 'px';
          
                  // Edit context menu
          
                  menu.querySelector('li:first-child').addEventListener('click', function() {
                    menu.remove();
          
                    const editModal = new bootstrap.Modal(document.getElementById('form'));
                    const modalTitle = document.getElementById('modal-title');
                    const titleInput = document.getElementById('event-title');
                    const startDateInput = document.getElementById('start-date');
                    const endDateInput = document.getElementById('end-date');
                    const colorInput = document.getElementById('event-color');
                    const submitButton = document.getElementById('submit-button');
                    const cancelButton = document.getElementById('cancel-button');
                    modalTitle.innerHTML = 'Edit Event';
                    titleInput.value = info.event.title;
                    startDateInput.value = moment(info.event.start).format('YYYY-MM-DD');
                    endDateInput.value = moment(info.event.end, 'YYYY-MM-DD').subtract(1, 'day').format('YYYY-MM-DD');
                    colorInput.value = info.event.backgroundColor;
                    submitButton.innerHTML = 'Save Changes';
          
                  
                  
          
          
                    editModal.show();
          
                    submitButton.classList.remove('btn-success')
                    submitButton.classList.add('btn-primary')
          
                    // Edit button
          
                    submitButton.addEventListener('click', function() {
                      const updatedEvents = {
                        id: info.event.id,
                        title: titleInput.value,
                        start: startDateInput.value,
                        end: moment(endDateInput.value, 'YYYY-MM-DD').add(1, 'day').format('YYYY-MM-DD'),
                        backgroundColor: colorInput.value
                      }
          
                      if ( updatedEvents.end <= updatedEvents.start) { // add if statement to check end date
                        dangerAlert.style.display = 'block';
                        return;
                      }
                    
                      const eventIndex = myEvents.findIndex(event => event.id === updatedEvents.id);
                      myEvents.splice(eventIndex, 1, updatedEvents);
                    
                      localStorage.setItem('events', JSON.stringify(myEvents));
                    
                      // Update the event in the calendar
                      const calendarEvent = calendar.getEventById(info.event.id);
                      calendarEvent.setProp('title', updatedEvents.title);
                      calendarEvent.setStart(updatedEvents.start);
                      calendarEvent.setEnd(updatedEvents.end);
                      calendarEvent.setProp('backgroundColor', updatedEvents.backgroundColor);
          
          
                    
                      editModal.hide();
          
                    })
          
                    
                  
                  });
          
                  // Delete menu
                  menu.querySelector('li:last-child').addEventListener('click', function() {
                    const deleteModal = new bootstrap.Modal(document.getElementById('delete-modal'));
                    const modalBody = document.getElementById('delete-modal-body');
                    const cancelModal = document.getElementById('cancel-button');
                    modalBody.innerHTML = `Are you sure you want to delete <b>"${info.event.title}"</b>`
                    deleteModal.show();
          
                    const deleteButton = document.getElementById('delete-button');
                    deleteButton.addEventListener('click', function () {
                      myEvents.splice(eventIndex, 1);
                      localStorage.setItem('events', JSON.stringify(myEvents));
                      calendar.getEventById(info.event.id).remove();
                      deleteModal.hide();
                      menu.remove();
          
                    });
          
                    cancelModal.addEventListener('click', function () { 
                      deleteModal.hide();
                    })
          
                    
                  
                  
                  });
                  document.addEventListener('click', function() {
                    menu.remove();
                  });
                });
              },
          
              eventDrop: function(info) { 
                let myEvents = JSON.parse(localStorage.getItem('events')) || [];
                const eventIndex = myEvents.findIndex(event => event.id === info.event.id);
                const updatedEvent = {
                  ...myEvents[eventIndex],
                  id: info.event.id, 
                  title: info.event.title,
                  start: moment(info.event.start).format('YYYY-MM-DD'),
                  end: moment(info.event.end).format('YYYY-MM-DD'),
                  backgroundColor: info.event.backgroundColor
                };
                myEvents.splice(eventIndex, 1, updatedEvent); // Replace old event data with updated event data
                localStorage.setItem('events', JSON.stringify(myEvents));
                console.log(updatedEvent);
              }
          
            });
          
            calendar.on('select', function(info) {
          
              const startDateInput = document.getElementById('start-date');
              const endDateInput = document.getElementById('end-date');
              startDateInput.value = info.startStr;
              const endDate = moment(info.endStr, 'YYYY-MM-DD').subtract(1, 'day').format('YYYY-MM-DD');
              endDateInput.value = endDate;
              if(startDateInput.value === endDate) {
                endDateInput.value = '';
              }
            });
          
          
            calendar.render();
          
            const form = document.querySelector('form');
          
            form.addEventListener('submit', function(event) {
              event.preventDefault(); // prevent default form submission
          
              // retrieve the form input values
              const title = document.querySelector('#event-title').value;
              const startDate = document.querySelector('#start-date').value;
              const endDate = document.querySelector('#end-date').value;
              const color = document.querySelector('#event-color').value;
              const endDateFormatted = moment(endDate, 'YYYY-MM-DD').add(1, 'day').format('YYYY-MM-DD');
              const eventId = uuidv4();
          
              console.log(eventId);
          
              if (endDateFormatted <= startDate) { // add if statement to check end date
                dangerAlert.style.display = 'block';
                return;
              }
          
              const newEvent = {
                id: eventId,
                title: title,
                start: startDate,
                end: endDateFormatted,
                allDay: false,
                backgroundColor: color
              };
          
              // add the new event to the myEvents array
              myEvents.push(newEvent);
          
              // render the new event on the calendar
              calendar.addEvent(newEvent);
          
              // save events to local storage
              localStorage.setItem('events', JSON.stringify(myEvents));
          
              myModal.hide();
              form.reset();
            });
          
            myModal._element.addEventListener('hide.bs.modal', function () {
              dangerAlert.style.display = 'none';
              form.reset(); 
            });
          
          });
    </body>
</html>